<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Inventory Manager - Trendmola</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dataTables_wrapper .dataTables_filter input {
            border: 2px solid #e2e8f0;
            padding: 0.75rem;
            border-radius: 0.5rem;
            width: 100%;
            max-width: 300px;
            background: #f8fafc;
            transition: all 0.3s ease;
        }
        
        .dataTables_wrapper .dataTables_filter input:focus {
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        table.dataTable thead th {
            background: linear-gradient(135deg, #1e40af 0%, #3730a3 100%);
            color: white;
            border: none;
            padding: 16px;
            font-weight: 600;
            text-align: left;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        table.dataTable tbody td {
            border: 1px solid #e2e8f0;
            padding: 14px;
            background: white;
            transition: background-color 0.2s ease;
        }
        
        table.dataTable tbody tr:hover td {
            background-color: #f1f5f9;
        }
        
        table.dataTable {
            border-collapse: collapse;
            width: 100%;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .status-working { 
            color: #059669; 
            font-weight: 600;
            background: #d1fae5;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
        }
        
        .status-expired { 
            color: #dc2626; 
            font-weight: 600;
            background: #fee2e2;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
        }
        
        .status-sold-out { 
            color: #dc2626; 
            font-weight: 600;
            background: #fef2f2;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
        }
        
        .modal {
            transition: opacity 0.3s ease-in-out;
            backdrop-filter: blur(5px);
        }
        
        .shadow-glow {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        .btn-purple:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }
        
        .btn-orange {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .btn-orange:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
        }
        
        .stats-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-left: 4px solid #3b82f6;
        }
        
        .brand-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Added login screen styles */
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Added password toggle styles */
        .password-container {
            position: relative;
        }
        
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #64748b;
            transition: color 0.2s ease;
        }
        
        .password-toggle:hover {
            color: #3b82f6;
        }
    </style>
</head>
<body class="font-sans">
    <!-- Added login screen -->
    <div id="loginScreen" class="fixed inset-0 flex items-center justify-center p-4">
        <div class="login-container p-8 rounded-2xl shadow-glow w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold brand-text mb-2">Trendmola</h1>
                <p class="text-slate-600">Account Manager Login</p>
            </div>
            <form id="loginForm">
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Username</label>
                    <input type="text" id="loginUsername" class="w-full border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white" required>
                </div>
                <!-- Added password visibility toggle -->
                <div class="mb-8">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Password</label>
                    <div class="password-container">
                        <input type="password" id="loginPassword" class="w-full border-2 border-slate-300 p-3 pr-12 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white" required>
                        <span class="password-toggle" onclick="togglePassword()">
                            <svg id="eyeIcon" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                            </svg>
                        </span>
                    </div>
                </div>
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-xl font-semibold">Login</button>
                <div id="loginError" class="text-red-500 text-sm mt-4 hidden text-center"></div>
            </form>
        </div>
    </div>

    <!-- Main app content wrapped in container -->
    <div id="mainApp" class="hidden min-h-screen p-4">
        <header class="mb-8 text-center">
            <div class="glass-effect rounded-2xl p-8 shadow-glow">
                <div class="flex justify-between items-center mb-4">
                    <div></div>
                    <div class="text-center">
                        <h1 class="text-4xl font-bold brand-text mb-2">Trendmola Account Manager</h1>
                        <p class="text-slate-600 text-lg mb-4">Professional Gaming, Streaming & Software Account Management</p>
                        <p class="text-sm text-slate-500">Made by <span class="font-semibold text-slate-700">Usman Yousaf</span></p>
                    </div>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition">
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="glass-effect p-8 rounded-2xl shadow-glow mb-8">
            <div class="flex flex-col lg:flex-row gap-4 mb-8">
                <select id="categoryFilter" class="border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                    <option value="">All Categories</option>
                </select>
                <!-- Added Add Category button -->
                <button onclick="addCategory()" class="btn-orange text-white px-6 py-3 rounded-xl font-semibold">Add Category</button>
                <input type="file" id="fileInput" accept=".xlsx, .xls" class="border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                <button onclick="addAccount()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">Add Account</button>
                <button onclick="downloadTemplate()" class="btn-success text-white px-6 py-3 rounded-xl font-semibold">Download Template</button>
                <button onclick="exportToExcel()" class="btn-purple text-white px-6 py-3 rounded-xl font-semibold">Export to Excel</button>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="stats-card p-4 rounded-xl">
                    <p class="text-slate-600 text-sm font-medium">Total Accounts</p>
                    <p class="text-2xl font-bold text-slate-800" id="totalAccounts">0</p>
                </div>
                <div class="stats-card p-4 rounded-xl">
                    <p class="text-slate-600 text-sm font-medium">Working</p>
                    <p class="text-2xl font-bold text-green-600" id="workingCount">0</p>
                </div>
                <div class="stats-card p-4 rounded-xl">
                    <p class="text-slate-600 text-sm font-medium">Expired</p>
                    <p class="text-2xl font-bold text-red-600" id="expiredCount">0</p>
                </div>
                <div class="stats-card p-4 rounded-xl">
                    <p class="text-slate-600 text-sm font-medium">Sold Out</p>
                    <p class="text-2xl font-bold text-blue-600" id="soldOutCount">0</p>
                </div>
            </div>
        </div>

        <div class="glass-effect p-8 rounded-2xl shadow-glow overflow-x-auto">
            <table id="accountsTable" class="display w-full">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Category</th>
                        <th>Email/Key</th>
                        <th>Password</th>
                        <th>Details</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Added Add Category Modal -->
    <div id="addCategoryModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center modal p-4">
        <div class="glass-effect p-8 rounded-2xl shadow-glow w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 brand-text">Add New Category</h2>
            <form id="categoryForm">
                <div class="mb-8">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Category Name</label>
                    <input type="text" id="newCategoryName" class="w-full border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white" required placeholder="Enter category name">
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closeCategoryModal()" class="bg-slate-500 text-white px-6 py-3 rounded-xl hover:bg-slate-600 transition font-semibold">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">Add Category</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Added Status Edit Modal -->
    <div id="editStatusModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center modal p-4">
        <div class="glass-effect p-8 rounded-2xl shadow-glow w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 brand-text">Edit Status</h2>
            <div class="mb-8">
                <label class="block text-sm font-semibold text-slate-700 mb-2">Select Status</label>
                <select id="statusDropdown" class="w-full border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                    <option value="Working">Working</option>
                    <option value="Expired">Expired</option>
                    <option value="Sold Out">Sold Out</option>
                </select>
            </div>
            <div class="flex justify-end gap-3">
                <button type="button" onclick="closeStatusModal()" class="bg-slate-500 text-white px-6 py-3 rounded-xl hover:bg-slate-600 transition font-semibold">Cancel</button>
                <button type="button" onclick="saveStatusChange()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">Save Status</button>
            </div>
        </div>
    </div>

    <!-- Added Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center modal p-4">
        <div class="glass-effect p-8 rounded-2xl shadow-glow w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-red-600">Delete Account</h2>
            <p class="text-slate-700 mb-8">Are you sure you want to delete this account? This action cannot be undone.</p>
            <div class="flex justify-end gap-3">
                <button type="button" onclick="closeDeleteModal()" class="bg-slate-500 text-white px-6 py-3 rounded-xl hover:bg-slate-600 transition font-semibold">No</button>
                <button type="button" onclick="confirmDelete()" class="bg-red-500 text-white px-6 py-3 rounded-xl hover:bg-red-600 transition font-semibold">Yes, Delete</button>
            </div>
        </div>
    </div>

    <!-- Existing code -->
    <div id="addAccountModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center modal p-4">
        <div class="glass-effect p-8 rounded-2xl shadow-glow w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 brand-text">Add New Account/Key</h2>
            <form id="accountForm">
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Category</label>
                    <select id="category" class="w-full border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white" required>
                        <option value="Gaming">Gaming</option>
                        <option value="Netflix">Netflix</option>
                        <option value="Crunchyroll">Crunchyroll</option>
                        <option value="Windows Key">Windows Key</option>
                        <option value="Office Key">Office Key</option>
                        <option value="Autodesk">Autodesk</option>
                        <option value="Adobe">Adobe</option>
                        <option value="Office 365">Office 365</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Email/Key</label>
                    <input type="text" id="email" class="w-full border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white" required>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Password (Optional for Keys)</label>
                    <input type="text" id="password" class="w-full border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Details</label>
                    <textarea id="details" class="w-full border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white h-24"></textarea>
                </div>
                <div class="mb-8">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Status</label>
                    <select id="status" class="w-full border-2 border-slate-300 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white" required>
                        <option value="Working">Working</option>
                        <option value="Expired">Expired</option>
                        <option value="Sold Out">Sold Out</option>
                    </select>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closeModal()" class="bg-slate-500 text-white px-6 py-3 rounded-xl hover:bg-slate-600 transition font-semibold">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">Save Account</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let accounts = [];
        let table;
        let categories = ['Gaming', 'Netflix', 'Crunchyroll', 'Windows Key', 'Office Key', 'Autodesk', 'Adobe', 'Office 365'];
        let currentEditingRow = null;
        let currentDeletingRow = null;

        $(document).ready(function() {
            checkLogin();
            $('#loginForm').on('submit', handleLogin);
            $('#categoryForm').on('submit', handleAddCategory);
        });

        function togglePassword() {
            const passwordInput = document.getElementById('loginPassword');
            const eyeIcon = document.getElementById('eyeIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.innerHTML = `
                    <path d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z"/>
                    <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"/>
                `;
            } else {
                passwordInput.type = 'password';
                eyeIcon.innerHTML = `
                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                `;
            }
        }

        function checkLogin() {
            const isLoggedIn = sessionStorage.getItem('trendmola_logged_in');
            if (isLoggedIn === 'true') {
                showMainApp();
            } else {
                $('#loginScreen').removeClass('hidden');
                $('#mainApp').addClass('hidden');
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = $('#loginUsername').val();
            const password = $('#loginPassword').val();
            
            if (username === 'goku.saiyan' && password === 'FinalFlash#2025') {
                sessionStorage.setItem('trendmola_logged_in', 'true');
                showMainApp();
            } else {
                $('#loginError').text('Invalid username or password').removeClass('hidden');
            }
        }

        function showMainApp() {
            $('#loginScreen').addClass('hidden');
            $('#mainApp').removeClass('hidden');
            initializeApp();
        }

        function logout() {
            sessionStorage.removeItem('trendmola_logged_in');
            $('#loginScreen').removeClass('hidden');
            $('#mainApp').addClass('hidden');
            $('#loginForm')[0].reset();
            $('#loginError').addClass('hidden');
        }

        function saveDataToStorage() {
            localStorage.setItem('trendmola_accounts', JSON.stringify(accounts));
            localStorage.setItem('trendmola_categories', JSON.stringify(categories));
            console.log('[v0] Data saved to localStorage');
        }

        function loadDataFromStorage() {
            const savedAccounts = localStorage.getItem('trendmola_accounts');
            const savedCategories = localStorage.getItem('trendmola_categories');
            
            if (savedAccounts) {
                accounts = JSON.parse(savedAccounts);
                console.log('[v0] Loaded accounts from localStorage:', accounts.length);
            }
            
            if (savedCategories) {
                categories = JSON.parse(savedCategories);
                console.log('[v0] Loaded categories from localStorage:', categories.length);
            }
        }

        function initializeApp() {
            loadDataFromStorage();
            
            updateCategoryDropdowns();
            
            table = $('#accountsTable').DataTable({
                data: accounts,
                columns: [
                    { data: 'index', searchable: false, orderable: true },
                    { data: 'category' },
                    { data: 'email' },
                    { data: 'password' },
                    { data: 'details' },
                    { 
                        data: 'status',
                        render: function(data) {
                            return `<span class="status-${data.toLowerCase().replace(' ', '-')}">${data}</span>`;
                        }
                    },
                    {
                        data: null,
                        orderable: false,
                        searchable: false,
                        render: function(data, type, row, meta) {
                            return `
                                <div class="flex gap-2 flex-wrap">
                                    <button onclick="editStatus(${meta.row})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-semibold transition">
                                        Edit Status
                                    </button>
                                    <button onclick="deleteAccount(${meta.row})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-xs font-semibold transition">
                                        Delete This Account
                                    </button>
                                </div>
                            `;
                        }
                    }
                ],
                pageLength: 10,
                responsive: true,
                order: [[0, 'asc']]
            });

            $('#fileInput').on('change', handleFile);
            $('#accountForm').on('submit', handleAddAccount);
            $('#categoryFilter').on('change', filterByCategory);
            updateCounts();
        }

        function updateCategoryDropdowns() {
            const categoryFilter = $('#categoryFilter');
            const categorySelect = $('#category');
            
            categoryFilter.empty().append('<option value="">All Categories</option>');
            categorySelect.empty();
            
            categories.forEach(category => {
                categoryFilter.append(`<option value="${category}">${category}</option>`);
                categorySelect.append(`<option value="${category}">${category}</option>`);
            });
        }

        function addCategory() {
            $('#addCategoryModal').removeClass('hidden');
        }

        function closeCategoryModal() {
            $('#addCategoryModal').addClass('hidden');
            $('#categoryForm')[0].reset();
        }

        function handleAddCategory(e) {
            e.preventDefault();
            const newCategory = $('#newCategoryName').val().trim();
            
            if (newCategory && !categories.includes(newCategory)) {
                categories.push(newCategory);
                updateCategoryDropdowns();
                saveDataToStorage();
                closeCategoryModal();
            }
        }

        function editStatus(rowIndex) {
            currentEditingRow = rowIndex;
            const currentStatus = accounts[rowIndex].status;
            $('#statusDropdown').val(currentStatus);
            $('#editStatusModal').removeClass('hidden');
        }

        function closeStatusModal() {
            $('#editStatusModal').addClass('hidden');
            currentEditingRow = null;
        }

        function saveStatusChange() {
            if (currentEditingRow !== null) {
                const newStatus = $('#statusDropdown').val();
                accounts[currentEditingRow].status = newStatus;
                table.row(currentEditingRow).data(accounts[currentEditingRow]).draw();
                updateCounts();
                saveDataToStorage();
                closeStatusModal();
            }
        }

        function handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(sheet);

                accounts = json.map((row, index) => ({
                    index: `Account ${index + 1}`,
                    category: row.Category || 'Gaming',
                    email: row['Email/Key'] || '',
                    password: row.Password || '',
                    details: row.Details || '',
                    status: row.Status || 'Working'
                }));

                table.clear().rows.add(accounts).draw();
                updateCounts();
                saveDataToStorage();
            };
            reader.readAsArrayBuffer(file);
        }

        function addAccount() {
            $('#addAccountModal').removeClass('hidden');
        }

        function closeModal() {
            $('#addAccountModal').addClass('hidden');
            $('#accountForm')[0].reset();
        }

        function handleAddAccount(e) {
            e.preventDefault();
            const newAccount = {
                index: `Account ${accounts.length + 1}`,
                category: $('#category').val(),
                email: $('#email').val(),
                password: $('#password').val(),
                details: $('#details').val(),
                status: $('#status').val()
            };
            accounts.push(newAccount);
            table.row.add(newAccount).draw();
            updateCounts();
            saveDataToStorage();
            closeModal();
        }

        function downloadTemplate() {
            const ws = XLSX.utils.json_to_sheet([
                { 
                    Category: 'Gaming', 
                    'Email/Key': 'example@domain.com', 
                    Password: 'password123', 
                    Details: 'Level 50, Rare skins', 
                    Status: 'Working' 
                }
            ]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template');
            XLSX.writeFile(wb, 'Account_Inventory_Template.xlsx');
        }

        function exportToExcel() {
            const exportData = accounts.map(({ category, email, password, details, status }) => ({
                Category: category,
                'Email/Key': email,
                Password: password,
                Details: details,
                Status: status
            }));
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Accounts');
            XLSX.writeFile(wb, 'Account_Inventory.xlsx');
        }

        function updateCounts() {
            const total = accounts.length;
            const working = accounts.filter(a => a.status === 'Working').length;
            const expired = accounts.filter(a => a.status === 'Expired').length;
            const soldOut = accounts.filter(a => a.status === 'Sold Out').length;
            $('#totalAccounts').text(total);
            $('#workingCount').text(working);
            $('#expiredCount').text(expired);
            $('#soldOutCount').text(soldOut);
        }

        function filterByCategory() {
            const selectedCategory = $('#categoryFilter').val();
            if (selectedCategory === '') {
                table.column(1).search('').draw();
            } else {
                table.column(1).search('^' + selectedCategory + '$', true, false).draw();
            }
        }

        function deleteAccount(rowIndex) {
            currentDeletingRow = rowIndex;
            $('#deleteConfirmModal').removeClass('hidden');
        }

        function closeDeleteModal() {
            $('#deleteConfirmModal').addClass('hidden');
            currentDeletingRow = null;
        }

        function confirmDelete() {
            if (currentDeletingRow !== null) {
                // Remove from accounts array
                accounts.splice(currentDeletingRow, 1);
                
                // Update index numbers for remaining accounts
                accounts.forEach((account, index) => {
                    account.index = `Account ${index + 1}`;
                });
                
                // Refresh table
                table.clear().rows.add(accounts).draw();
                updateCounts();
                saveDataToStorage();
                closeDeleteModal();
            }
        }
    </script>
</body>
</html>
